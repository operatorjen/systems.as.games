(()=>{var f={garden:{seedling:"\u{1F331}",leaf:"\u{1F343}",jar:"\u{1FAD9}",ant:"\u{1F41C}",eagle:"\u{1F985}",feather:"\u{1FAB6}",owl:"\u{1F989}"},river:{water:"\u{1F4A7}",gold:"\u{1F4B0}",wood:"\u{1FAB5}",stone:"\u{1FAA8}",reed:"\u{1F33F}",fish:"\u{1F41F}",sponge:"\u{1F9FD}"},mountain:{water:"\u{1F4A7}",mushroom:"\u{1F344}",wood:"\u{1FAB5}",stone:"\u{1FAA8}",ice:"\u{1F9CA}",gem:"\u{1F48E}",tool:"\u{1FA93}"}},I={garden:["seedling","leaf","jar","ant","eagle","feather","owl"],river:["water","gold","wood","stone","reed","fish","sponge"],mountain:["water","mushroom","wood","stone","ice","gem","tool"]},le=[{inputs:["SAG-001","leaf","gem"]},{inputs:["SAG-235","SAG-041","SAG-466"]},{inputs:["water","SAG-125","tool"]}],A={garden:Object.fromEntries(I.garden.map((n,o)=>[n,o])),river:Object.fromEntries(I.river.map((n,o)=>[n,o])),mountain:Object.fromEntries(I.mountain.map((n,o)=>[n,o]))};function Y(n,o,g,r="SAG-"){let l=A.garden[o],i=A.river[n],c=A.mountain[g];return[i,l,c].some(s=>s==null)?null:`${r}${i}${l}${c}`}var V=n=>/^SAG-[0-6]{3}$/.test(String(n));function q(n){let o=/^SAG-(\d)(\d)(\d)$/.exec(String(n));return o?{r:+o[1],g:+o[2],m:+o[3]}:null}function ce(n){let o=n.slice(0,3);if(o.every(V)){let i=q(o[0]),c=q(o[1]),s=q(o[2]);return`SAG-${i.r}${c.g}${s.m}`}let g=null,r=null,l=null;for(let i of o){if(V(i)){let c=q(i);g==null&&(g=c.r),r==null&&(r=c.g),l==null&&(l=c.m);continue}i in A.river&&(g=A.river[i]),i in A.garden&&(r=A.garden[i]),i in A.mountain&&(l=A.mountain[i])}return g==null||r==null||l==null?null:`SAG-${g}${r}${l}`}var F=[{garden:"seedling",river:"water",mountain:"mushroom"},{garden:"leaf",river:"wood",mountain:"gem"},{garden:"jar",river:"sponge",mountain:"tool"}];function Z(n=F,o=[]){return[...n.map(r=>[r.river,r.garden,r.mountain]),...o.map(r=>r.inputs)].filter(Boolean).map(r=>{let l=ce(r),i=`unlock:${l}`,c=Object.create(null);for(let s of r)c[s]=(c[s]||0)+1;return{id:`code-${r.join("-")}`,label:l,icon:"\u{1F50F}",description:r.map(s=>f.river[s]||f.garden[s]||f.mountain[s]||"\u{1F50F}").join(" + ")+` \u2192 ${l}`,requires:c,gives:{[l]:1},flag:i}})}var W=Z(F,le);function B({crafts:n=F,previewSelector:o="#status"}={}){let g=new Set;function r(){let l=window.SAG&&window.SAG.get&&window.SAG.get()||{},i=l.inv||{},c=new Set(l.flags||{}),s=!1;for(let d of n){let P=Y(d.river,d.garden,d.mountain),G=d.flag||`unlock:${P}`;if(c.has(G)||g.has(G))continue;if((i[d.river]|0)>0&&(i[d.garden]|0)>0&&(i[d.mountain]|0)>0){s=!1;break}}if(s){el.textContent="";return}}setInterval(r,800),r()}function de(){let n=[];for(let o of I.river)for(let g of I.garden)for(let r of I.mountain)n.push({river:o,garden:g,mountain:r});return n}var D=n=>Object.keys(n),me=D(f.river),ue=D(f.garden),fe=D(f.mountain);var ge={...f.river,...f.garden,...f.mountain};typeof window<"u"&&(window.SAGCodes={ICONS:f,ALPHABET:I,genCode:Y,CRAFTS:F,buildRecipes:Z,RECIPES:W,startAutoUnlocker:B,allCombos:de});(()=>{let n=f.river,o={...f.garden,...f.river,...f.mountain};SAGGame.init(),SAGGame.inventory.init({title:"River Inventory",recipes:SAGCraft.recipes().concat(W),icons:n,craftIcons:o}),B();let g=Object.keys(n),r=Object.fromEntries(g.map(e=>[e,SAGGame.morseForWord(e)])),l=SAGGame.morseItemClaimer(r,{once:!1}),i=SAGGame.morse({el:"#wave",out:"#out",status:"#status",clear:"#clear",unit:240,tolerance:.55,letterGapMul:2.2,wordGapMul:5.5,autoWordMs:500,symbolSpacing:"thin",onWord(e){let t=SAGGame.claimSAG(e);if(t==="hit"||t==="duplicate"){i.reset();return}t=l(e),(t==="hit"||t==="duplicate")&&i.reset()}}),c="images/river.jpg",s=document.getElementById("wave"),d=s.getContext("2d",{alpha:!0,desynchronized:!0}),P=Math,{sin:G,ceil:N,min:C,PI:ee}=P,S=ee*2,a={dpr:Math.max(1,C(2,window.devicePixelRatio||1)),img:null,off:null,o:null,t0:performance.now()},z=e=>e<40?40:e,te=e=>e<1?1:e,y=0;function H(){let e=innerWidth,t=innerHeight;s.width=~~(e*a.dpr),s.height=~~(t*a.dpr),s.style.width=e+"px",s.style.height=t+"px",d.setTransform(a.dpr,0,0,a.dpr,0,0)}addEventListener("resize",H,{passive:!0}),H();class p{constructor({min:t,max:h,holdMin:m=2,holdMax:u=6,ease:v=.08}){Object.assign(this,{min:t,max:h,holdMin:m,holdMax:u,ease:v}),this.v=this._r(t,h),this.target=this.v,this.nextAt=0}_r(t,h){return t+Math.random()*(h-t)}step(t){return t>=this.nextAt&&(this.target=this._r(this.min,this.max),this.nextAt=t+this._r(this.holdMin,this.holdMax)),this.v+=(this.target-this.v)*this.ease}}let x={Ax:new p({min:6,max:28}),Ay:new p({min:6,max:24}),Lx:new p({min:180,max:520}),Ly:new p({min:140,max:480}),Sx:new p({min:-1.6,max:1.6,holdMin:3,holdMax:8}),Sy:new p({min:-1.5,max:1.5,holdMin:3,holdMax:8}),st:new p({min:1.5,max:3.5,holdMin:4,holdMax:10}),phx:new p({min:0,max:S,holdMin:5,holdMax:10,ease:.03}),phy:new p({min:0,max:S,holdMin:5,holdMax:10,ease:.03})},R=new Image;R.crossOrigin="anonymous",R.src=c,R.onload=()=>{a.img=R,requestAnimationFrame(K)};let ne=(e,t,h)=>{let m=e.naturalWidth,u=e.naturalHeight,v=m/u,O=t/h,b,M,T=0,L=0;return v>O?(M=h,b=M*v,T=(t-b)/2):(b=t,M=b/v,L=(h-M)/2),{sx:0,sy:0,sw:m,sh:u,dx:T,dy:L,dw:b,dh:M}};function oe(e,t){a.off||(a.off=document.createElement("canvas"),a.o=a.off.getContext("2d",{alpha:!1})),a.o.globalCompositeOperation="source-over",e=e|0,t=t|0,e<1&&(e=1),t<1&&(t=1),(a.off.width!==e||a.off.height!==t)&&(a.off.width=e,a.off.height=t)}function K(e){re((e-a.t0)/1e3),requestAnimationFrame(K)}function re(e){if(!a.img)return;let t=s.width/a.dpr,h=s.height/a.dpr,m=ne(a.img,t,h);oe(m.dw,m.dh);let u=a.off,v=a.o;v.setTransform(1,0,0,1,0,0),v.drawImage(a.img,m.sx,m.sy,m.sw,m.sh,0,0,m.dw,m.dh),d.clearRect(0,0,t,h),d.save(),d.translate(m.dx,m.dy);let O=x.Ax.step(e),b=x.Ay.step(e),M=z(x.Lx.step(e)),T=z(x.Ly.step(e)),L=x.Sx.step(e),ie=x.Sy.step(e),$=te(x.st.step(e)|0),se=x.phx.step(e),ae=x.phy.step(e),J=1+y*.85,_=3,Q=y*.35;for(let k=0,U=N(u.height/$);k<U;k++){let w=k*$,E=C($,u.height-w),j=w/M*S+e*S*L+se,X=G(j)*O*J+G(j*_+e*S*_)*O*Q;d.drawImage(u,0,w,u.width,E,X,w,u.width,E)}d.globalAlpha=.65;for(let k=0,U=N(u.width/$);k<U;k++){let w=k*$,E=C($,u.width-w),j=w/T*S+e*S*ie+ae,X=G(j)*b*J+G(j*_+e*S*_)*b*Q;d.drawImage(u,w,0,E,u.height,w,X,E,u.height)}d.restore(),y*=.93,y<.001&&(y=0)}s.addEventListener("click",e=>{y=C(3,y+22.9)}),function(){let e=[{a:"water",b:"silt",out:"mud"},{a:"driftwood",b:"driftwood",out:"plank"},{a:"stone",b:"stone",out:"pebble-pile"},{a:"gold",b:"silt",out:"gold-nugget"},{a:"reed",b:"reed",out:"rope"},{a:"mud",b:"stone",out:"clay-brick"},{a:"plank",b:"rope",out:"raft"},{a:"gold-nugget",b:"gold-nugget",out:"gold-bar"},{a:"pebble-pile",b:"plank",out:"millstone"},{a:"clay-brick",b:"millstone",out:"kiln"},{a:"raft",b:"plank",out:"bridge"},{a:"gold-bar",b:"rope",out:"crown"}];SAGCraft.registerRecipes(e)}()})();})();
