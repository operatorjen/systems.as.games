(()=>{var g=t=>/^sag[-\s]?[0-6]{3}$/i.test(t),d=t=>{let s=String(t||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(s);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},w=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],G=["dark","dim","glint","bright","halo","gaze","overwatch"],S=["plain","hills","ridge","cliffs","crags","glacier","abyss"],v=["none","hint","cells","triangles","pyramids","facets","tessellation"],A=(t,s,e)=>(t+2*s+3*e)%7;function x({crumbsSelector:t="#crumbs-rail"}={}){let s=SAG?.get?.()||{},e=new Set(s.flags||[]);for(let c of e)if(c.startsWith("active:SAG-"))return;let o=[...e].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),a=Object.keys(s.inv||{}).filter(c=>/^SAG-[0-6]{3}$/.test(c)),n=o[0]||a[0];if(!n)return;let i=m(n);i&&h(i,{crumbsSelector:t})}function p(t){let s=[];for(let e of t){if(!e.startsWith("unlock:SAG-"))continue;let o=e.replace("unlock:","");s.push([null,u(o),`${o}`,`active:${o}`])}return s}var b={"art.of.noise":"\u25B2\u25BC\u25B2","1k.quantumworm":"\u25B2\u25B2\u25BC","bean.sims":"\u25B2\u25BC\u25BC",mcsv:"\u25BC\u25B2\u25BC","artificial.lifeforms":"\u25BC\u25BC\u25B2"};function $(t){let s=Object.entries(t);for(let e=s.length-1;e>0;e--){let o=Math.floor(Math.random()*(e+1));[s[e],s[o]]=[s[o],s[e]]}return Object.fromEntries(s)}function k(){let t=document.createElement("a");t.id="home";let s=$(b);t.href=s[0]||"https://operatorjen.github.io/systems.as.games/ECOSYSTEM",t.textContent=s[1]||"\u25B2\u25B2\u25B2",document.body.appendChild(t)}k();var u=(t,s="elements")=>{let e=m(t),o=encodeURIComponent(t);if(!e)return`/systems.as.games/garden.html?code=${o}`;let a=r=>Number(r||0),n={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:a(e?.motifs?.helios?.level),crags:a(e?.motifs?.crags?.level),garden:a(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((t||"").replace(/\D/g,"")||0))},i={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(i[t])return`/${i[t]}/index.html?code=${o}`;let c={elements:[{when:r=>n.day&&n.helios>=3,to:"mcsv"},{when:r=>n.wind||n.crags>=3,to:"1k.quantumworm"},{when:r=>n.garden>=2||n.water||n.life,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],facet:[{when:r=>/sound|music|noise/.test(n.facet),to:"mcsv"},{when:r=>/mountain|rock|crag|cave/.test(n.facet),to:"1k.quantumworm"},{when:r=>/garden|river|organism|bio|life/.test(n.facet),to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],calmVsWild:[{when:r=>(n.wind?1:0)+(n.crags>=2?1:0)+(n.day?0:1)>=2,to:"1k.quantumworm"},{when:r=>n.garden>=2||n.life,to:"artificial.lifeforms"},{when:r=>n.day||n.helios>=2,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}],hash:[{when:r=>n.seed%4===0,to:"mcsv"},{when:r=>n.seed%4===1,to:"1k.quantumworm"},{when:r=>n.seed%4===2,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],rarity:[{when:r=>n.helios>=4&&n.crags>=4,to:"1k.quantumworm"},{when:r=>n.garden>=4,to:"artificial.lifeforms"},{when:r=>n.helios>=4,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}]},f=c[s]||c.elements;return`/${(f.find(r=>r.when(e))||f[f.length-1]).to}/index.html?code=${o}`};function C(t){let s=u(t),e=SAG?.get?.()||{},o=new Set(e.flags||[]);o.add(`unlock:${t}`).add(`active:${t}`);let a=SAG.href(s,{flags:[...o]});location.assign(a)}var m=t=>{let s=d(t);if(!s)return null;let{R:e,G:o,M:a,seed:n}=s,i=A(e,o,a);return{code:s.code,seed:n,motifs:{garden:{level:e,name:w[e]},helios:{level:o,name:G[o]},crags:{level:a,name:S[a]},facet:{level:i,name:v[i]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+o*.06,gateCost:1+a,wind:a>=3,facetDepth:i,daylight:!(o%2)}}},h=(t,{crumbsSelector:s="#crumbs-rail"}={})=>{if(!t)return;let{code:e,motifs:o,knobs:a}=t,n=SAG?.get?.()||{},i=new Set(n.flags||[]);for(let l of[...i])l.startsWith("active:SAG-")&&i.delete(l);i.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...i]}),SAGGame?.toast?.(`${e} \u2014 ${o.garden.name} \xB7 ${o.helios.name} \xB7 ${o.crags.name} \xB7 ${o.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let l=document.documentElement;l.dataset.sag=e,l.dataset.sagGarden=o.garden.level,l.dataset.sagHelios=o.helios.level,l.dataset.sagCrags=o.crags.level,l.dataset.sagFacet=o.facet.level,l.dataset.sagWind=a.wind?"1":"0",l.dataset.sagDay=a.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!a.wind),SAGGame?.setTheme?.(a.daylight?"day":"night"),SAGGame?.setFacetDepth?.(a.facetDepth);let c=SAG.get()||{},f=new Set(c.flags||[]);SAGGame?.breadcrumbs?.([[`active:${e}`,u(e),`${e}`],...p(f)],s)},y=(t,s)=>{let e=m(t);return e&&(h(e,s),e)},_=(t,s,e="overlay")=>{let o=d(t),a=d(s);if(!o||!a)return null;let n=e==="overlay"?Math.max:(i,c)=>(i^c)%7;return`SAG-${n(o.R,a.R)}${n(o.G,a.G)}${n(o.M,a.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:g,parseSAG:d,worldFromSAG:m,activateSAGWorld:h,activateCode:y,mergeSAG:_});})();
