(()=>{var g=n=>/^sag[-\s]?[0-6]{3}$/i.test(n),f=n=>{let a=String(n||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(a);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},w=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],G=["dark","dim","glint","bright","halo","gaze","overwatch"],S=["plain","hills","ridge","cliffs","crags","glacier","abyss"],p=["none","hint","cells","triangles","pyramids","facets","tessellation"],v=(n,a,e)=>(n+2*a+3*e)%7;function k({crumbsSelector:n="#crumbs-rail"}={}){let a=SAG?.get?.()||{},e=new Set(a.flags||[]);for(let c of e)if(c.startsWith("active:SAG-"))return;let o=[...e].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),s=Object.keys(a.inv||{}).filter(c=>/^SAG-[0-6]{3}$/.test(c)),t=o[0]||s[0];if(!t)return;let i=m(t);i&&h(i,{crumbsSelector:n})}function A(n){let a=[];for(let e of n){if(!e.startsWith("unlock:SAG-"))continue;let o=e.replace("unlock:","");a.push([null,u(o),`${o}`,`active:${o}`])}return a}var $={"art.of.noise":"\u25B2\u25BC\u25B2","1k.quantumworm":"\u25B2\u25B2\u25BC","bean.sims":"\u25B2\u25BC\u25BC",mcsv:"\u25BC\u25B2\u25BC","artificial.lifeforms":"\u25BC\u25BC\u25B2"};function _(n){let a=Object.entries($),[e,o]=a.length?a[Math.random()*a.length|0]:["systems.as.games/ECOSYSTEM","\u25B2\u25B2\u25B2"],s=document.createElement("a");s.id="home",s.href=`https://operatorjen.github.io/${e}`,s.textContent=o||"\u25B2\u25B2\u25B2",document.body.appendChild(s)}var u=(n,a="elements")=>{let e=m(n),o=encodeURIComponent(n);if(!e)return`/systems.as.games/garden.html?code=${o}`;let s=r=>Number(r||0),t={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:s(e?.motifs?.helios?.level),crags:s(e?.motifs?.crags?.level),garden:s(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((n||"").replace(/\D/g,"")||0))},i={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(i[n])return`/${i[n]}/index.html?code=${o}`;let c={elements:[{when:r=>t.day&&t.helios>=3,to:"mcsv"},{when:r=>t.wind||t.crags>=3,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.water||t.life,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],facet:[{when:r=>/sound|music|noise/.test(t.facet),to:"mcsv"},{when:r=>/mountain|rock|crag|cave/.test(t.facet),to:"1k.quantumworm"},{when:r=>/garden|river|organism|bio|life/.test(t.facet),to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],calmVsWild:[{when:r=>(t.wind?1:0)+(t.crags>=2?1:0)+(t.day?0:1)>=2,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.life,to:"artificial.lifeforms"},{when:r=>t.day||t.helios>=2,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}],hash:[{when:r=>t.seed%4===0,to:"mcsv"},{when:r=>t.seed%4===1,to:"1k.quantumworm"},{when:r=>t.seed%4===2,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],rarity:[{when:r=>t.helios>=4&&t.crags>=4,to:"1k.quantumworm"},{when:r=>t.garden>=4,to:"artificial.lifeforms"},{when:r=>t.helios>=4,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}]},d=c[a]||c.elements;return`/${(d.find(r=>r.when(e))||d[d.length-1]).to}/index.html?code=${o}`};function x(n){let a=u(n),e=SAG?.get?.()||{},o=new Set(e.flags||[]);o.add(`unlock:${n}`).add(`active:${n}`);let s=SAG.href(a,{flags:[...o]});location.assign(s)}var m=n=>{let a=f(n);if(!a)return null;let{R:e,G:o,M:s,seed:t}=a,i=v(e,o,s);return{code:a.code,seed:t,motifs:{garden:{level:e,name:w[e]},helios:{level:o,name:G[o]},crags:{level:s,name:S[s]},facet:{level:i,name:p[i]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+o*.06,gateCost:1+s,wind:s>=3,facetDepth:i,daylight:!(o%2)}}},h=(n,{crumbsSelector:a="#crumbs-rail"}={})=>{if(!n)return;let{code:e,motifs:o,knobs:s}=n,t=SAG?.get?.()||{},i=new Set(t.flags||[]);for(let l of[...i])l.startsWith("active:SAG-")&&i.delete(l);i.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...i]}),SAGGame?.toast?.(`${e} \u2014 ${o.garden.name} \xB7 ${o.helios.name} \xB7 ${o.crags.name} \xB7 ${o.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let l=document.documentElement;l.dataset.sag=e,l.dataset.sagGarden=o.garden.level,l.dataset.sagHelios=o.helios.level,l.dataset.sagCrags=o.crags.level,l.dataset.sagFacet=o.facet.level,l.dataset.sagWind=s.wind?"1":"0",l.dataset.sagDay=s.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!s.wind),SAGGame?.setTheme?.(s.daylight?"day":"night"),SAGGame?.setFacetDepth?.(s.facetDepth);let c=SAG.get()||{},d=new Set(c.flags||[]);SAGGame?.breadcrumbs?.([[`active:${e}`,u(e),`${e}`],...A(d)],a)},b=(n,a)=>{let e=m(n);return e&&(h(e,a),e)},y=(n,a,e="overlay")=>{let o=f(n),s=f(a);if(!o||!s)return null;let t=e==="overlay"?Math.max:(i,c)=>(i^c)%7;return`SAG-${t(o.R,s.R)}${t(o.G,s.G)}${t(o.M,s.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:g,parseSAG:f,worldFromSAG:m,activateSAGWorld:h,activateCode:b,mergeSAG:y});})();
