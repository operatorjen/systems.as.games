(()=>{var h=n=>/^sag[-\s]?[0-6]{3}$/i.test(n),d=n=>{let a=String(n||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(a);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},w=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],G=["dark","dim","glint","bright","halo","gaze","overwatch"],S=["plain","hills","ridge","cliffs","crags","glacier","abyss"],A=["none","hint","cells","triangles","pyramids","facets","tessellation"],v=(n,a,e)=>(n+2*a+3*e)%7;function b({crumbsSelector:n="#crumbs-rail"}={}){let a=SAG?.get?.()||{},e=new Set(a.flags||[]);for(let c of e)if(c.startsWith("active:SAG-"))return;let s=[...e].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),o=Object.keys(a.inv||{}).filter(c=>/^SAG-[0-6]{3}$/.test(c)),t=s[0]||o[0];if(!t)return;let i=m(t);i&&g(i,{crumbsSelector:n})}function p(n){let a=[];for(let e of n){if(!e.startsWith("unlock:SAG-"))continue;let s=e.replace("unlock:","");a.push([null,u(s),`${s}`,`active:${s}`])}return a}var u=(n,a="elements")=>{let e=m(n),s=encodeURIComponent(n);if(!e)return`/systems.as.games/garden.html?code=${s}`;let o=r=>Number(r||0),t={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:o(e?.motifs?.helios?.level),crags:o(e?.motifs?.crags?.level),garden:o(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((n||"").replace(/\D/g,"")||0))},i={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(i[n])return`/${i[n]}/index.html?code=${s}`;let c={elements:[{when:r=>t.day&&t.helios>=3,to:"mcsv"},{when:r=>t.wind||t.crags>=3,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.water||t.life,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],facet:[{when:r=>/sound|music|noise/.test(t.facet),to:"mcsv"},{when:r=>/mountain|rock|crag|cave/.test(t.facet),to:"1k.quantumworm"},{when:r=>/garden|river|organism|bio|life/.test(t.facet),to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],calmVsWild:[{when:r=>(t.wind?1:0)+(t.crags>=2?1:0)+(t.day?0:1)>=2,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.life,to:"artificial.lifeforms"},{when:r=>t.day||t.helios>=2,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}],hash:[{when:r=>t.seed%4===0,to:"mcsv"},{when:r=>t.seed%4===1,to:"1k.quantumworm"},{when:r=>t.seed%4===2,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],rarity:[{when:r=>t.helios>=4&&t.crags>=4,to:"1k.quantumworm"},{when:r=>t.garden>=4,to:"artificial.lifeforms"},{when:r=>t.helios>=4,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}]},f=c[a]||c.elements;return`/${(f.find(r=>r.when(e))||f[f.length-1]).to}/index.html?code=${s}`};function y(n){let a=u(n),e=SAG?.get?.()||{},s=new Set(e.flags||[]);s.add(`unlock:${n}`).add(`active:${n}`);let o=SAG.href(a,{flags:[...s]});location.assign(o)}var m=n=>{let a=d(n);if(!a)return null;let{R:e,G:s,M:o,seed:t}=a,i=v(e,s,o);return{code:a.code,seed:t,motifs:{garden:{level:e,name:w[e]},helios:{level:s,name:G[s]},crags:{level:o,name:S[o]},facet:{level:i,name:A[i]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+s*.06,gateCost:1+o,wind:o>=3,facetDepth:i,daylight:!(s%2)}}},g=(n,{crumbsSelector:a="#crumbs-rail"}={})=>{if(!n)return;let{code:e,motifs:s,knobs:o}=n,t=SAG?.get?.()||{},i=new Set(t.flags||[]);for(let l of[...i])l.startsWith("active:SAG-")&&i.delete(l);i.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...i]}),SAGGame?.toast?.(`${e} \u2014 ${s.garden.name} \xB7 ${s.helios.name} \xB7 ${s.crags.name} \xB7 ${s.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let l=document.documentElement;l.dataset.sag=e,l.dataset.sagGarden=s.garden.level,l.dataset.sagHelios=s.helios.level,l.dataset.sagCrags=s.crags.level,l.dataset.sagFacet=s.facet.level,l.dataset.sagWind=o.wind?"1":"0",l.dataset.sagDay=o.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!o.wind),SAGGame?.setTheme?.(o.daylight?"day":"night"),SAGGame?.setFacetDepth?.(o.facetDepth);let c=SAG.get()||{},f=new Set(c.flags||[]);SAGGame?.breadcrumbs?.([[`active:${e}`,u(e),`${e}`],...p(f)],a)},$=(n,a)=>{let e=m(n);return e&&(g(e,a),e)},k=(n,a,e="overlay")=>{let s=d(n),o=d(a);if(!s||!o)return null;let t=e==="overlay"?Math.max:(i,c)=>(i^c)%7;return`SAG-${t(s.R,o.R)}${t(s.G,o.G)}${t(s.M,o.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:h,parseSAG:d,worldFromSAG:m,activateSAGWorld:g,activateCode:$,mergeSAG:k});})();
