(()=>{var w=o=>/^sag[-\s]?[0-6]{3}$/i.test(o),m=o=>{let s=String(o||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(s);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},G=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],S=["dark","dim","glint","bright","halo","gaze","overwatch"],v=["plain","hills","ridge","cliffs","crags","glacier","abyss"],A=["none","hint","cells","triangles","pyramids","facets","tessellation"],p=(o,s,e)=>(o+2*s+3*e)%7;function x({crumbsSelector:o="#crumbs-rail"}={}){let s=SAG?.get?.()||{},e=new Set(s.flags||[]);for(let c of e)if(c.startsWith("active:SAG-"))return;let t=[...e].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),r=Object.keys(s.inv||{}).filter(c=>/^SAG-[0-6]{3}$/.test(c)),n=t[0]||r[0];if(!n)return;let i=u(n);i&&g(i,{crumbsSelector:o})}function b(o){let s=[];for(let e of o){if(!e.startsWith("unlock:SAG-"))continue;let t=e.replace("unlock:","");s.push([null,h(t),`${t}`,`active:${t}`])}return s}var h=(o,s="elements")=>{let e=u(o),t=encodeURIComponent(o);if(!e)return`/systems.as.games/garden.html?code=${t}`;let r=a=>Number(a||0),n={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:r(e?.motifs?.helios?.level),crags:r(e?.motifs?.crags?.level),garden:r(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((o||"").replace(/\D/g,"")||0))},i={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(i[o])return`/${i[o]}/index.html?code=${t}`;let c={elements:[{when:a=>n.day&&n.helios>=3,to:"mcsv"},{when:a=>n.wind||n.crags>=3,to:"1k.quantumworm"},{when:a=>n.garden>=2||n.water||n.life,to:"artificial.lifeforms"},{when:a=>!0,to:"art.of.noise"}],facet:[{when:a=>/sound|music|noise/.test(n.facet),to:"mcsv"},{when:a=>/mountain|rock|crag|cave/.test(n.facet),to:"1k.quantumworm"},{when:a=>/garden|river|organism|bio|life/.test(n.facet),to:"artificial.lifeforms"},{when:a=>!0,to:"art.of.noise"}],calmVsWild:[{when:a=>(n.wind?1:0)+(n.crags>=2?1:0)+(n.day?0:1)>=2,to:"1k.quantumworm"},{when:a=>n.garden>=2||n.life,to:"artificial.lifeforms"},{when:a=>n.day||n.helios>=2,to:"mcsv"},{when:a=>!0,to:"art.of.noise"}],hash:[{when:a=>n.seed%4===0,to:"mcsv"},{when:a=>n.seed%4===1,to:"1k.quantumworm"},{when:a=>n.seed%4===2,to:"artificial.lifeforms"},{when:a=>!0,to:"art.of.noise"}],rarity:[{when:a=>n.helios>=4&&n.crags>=4,to:"1k.quantumworm"},{when:a=>n.garden>=4,to:"artificial.lifeforms"},{when:a=>n.helios>=4,to:"mcsv"},{when:a=>!0,to:"art.of.noise"}]},f=c[s]||c.elements;return`/${(f.find(a=>a.when(e))||f[f.length-1]).to}/index.html?code=${t}`};function C(o){let s=h(o),e=SAG?.get?.()||{},t=new Set(e.flags||[]);t.add(`unlock:${o}`).add(`active:${o}`);let r=SAG.href(s,{flags:[...t]});location.assign(r)}var u=o=>{let s=m(o);if(!s)return null;let{R:e,G:t,M:r,seed:n}=s,i=p(e,t,r);return{code:s.code,seed:n,motifs:{garden:{level:e,name:G[e]},helios:{level:t,name:S[t]},crags:{level:r,name:v[r]},facet:{level:i,name:A[i]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+t*.06,gateCost:1+r,wind:r>=3,facetDepth:i,daylight:!(t%2)}}},$={"art.of.noise":"\u25B2\u25BC\u25B2","1k.quantumworm":"\u25B2\u25B2\u25BC","bean.sims":"\u25B2\u25BC\u25BC",mcsv:"\u25BC\u25B2\u25BC","artificial.lifeforms":"\u25BC\u25BC\u25B2"};function k(o){let s=Object.entries(o);for(let e=s.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return Object.fromEntries(s)}var g=(o,{crumbsSelector:s="#crumbs-rail"}={})=>{if(!o)return;let{code:e,motifs:t,knobs:r}=o,n=SAG?.get?.()||{},i=new Set(n.flags||[]);for(let l of[...i])l.startsWith("active:SAG-")&&i.delete(l);i.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...i]}),SAGGame?.toast?.(`${e} \u2014 ${t.garden.name} \xB7 ${t.helios.name} \xB7 ${t.crags.name} \xB7 ${t.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let l=document.documentElement;l.dataset.sag=e,l.dataset.sagGarden=t.garden.level,l.dataset.sagHelios=t.helios.level,l.dataset.sagCrags=t.crags.level,l.dataset.sagFacet=t.facet.level,l.dataset.sagWind=r.wind?"1":"0",l.dataset.sagDay=r.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!r.wind),SAGGame?.setTheme?.(r.daylight?"day":"night"),SAGGame?.setFacetDepth?.(r.facetDepth);let c=SAG.get()||{},f=new Set(c.flags||[]);SAGGame?.breadcrumbs?.([[`active:${e}`,h(e),`${e}`],...b(f)],s);let d=document.createElement("a");d.id="home";let a=k($);d.href=a[0]||"https://operatorjen.github.io/systems.as.games/ECOSYSTEM",d.textContent=a[1]||"\u25B2\u25B2\u25B2",document.body.appendChild(d)},y=(o,s)=>{let e=u(o);return e&&(g(e,s),e)},_=(o,s,e="overlay")=>{let t=m(o),r=m(s);if(!t||!r)return null;let n=e==="overlay"?Math.max:(i,c)=>(i^c)%7;return`SAG-${n(t.R,r.R)}${n(t.G,r.G)}${n(t.M,r.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:w,parseSAG:m,worldFromSAG:u,activateSAGWorld:g,activateCode:y,mergeSAG:_});})();
