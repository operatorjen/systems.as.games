(()=>{var g=o=>/^sag[-\s]?[0-6]{3}$/i.test(o),m=o=>{let a=String(o||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(a);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},w=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],p=["dark","dim","glint","bright","halo","gaze","overwatch"],S=["plain","hills","ridge","cliffs","crags","glacier","abyss"],G=["none","hint","cells","triangles","pyramids","facets","tessellation"],v=(o,a,e)=>(o+2*a+3*e)%7;function C({crumbsSelector:o="#crumbs-rail"}={}){let a=SAG?.get?.()||{},e=new Set(a.flags||[]);for(let c of e)if(c.startsWith("active:SAG-"))return;let n=[...e].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),s=Object.keys(a.inv||{}).filter(c=>/^SAG-[0-6]{3}$/.test(c)),t=n[0]||s[0];if(!t)return;let i=f(t);i&&u(i,{crumbsSelector:o})}function A(o){let a=[];for(let e of o){if(!e.startsWith("unlock:SAG-"))continue;let n=e.replace("unlock:","");a.push([null,h(n),`${n}`,`active:${n}`])}return a}var b={"art.of.noise":"\u25B2\u25BC\u25B2","1k.quantumworm":"\u25B2\u25B2\u25BC","bean.sims":"\u25B2\u25BC\u25BC",mcsv:"\u25BC\u25B2\u25BC","artificial.lifeforms":"\u25BC\u25BC\u25B2"};function y(){let o=Object.entries(b),[a,e]=o.length?o[Math.random()*o.length|0]:["systems.as.games/ECOSYSTEM","\u25B2\u25B2\u25B2"],n=document.createElement("a");n.id="home";let s=new URLSearchParams(location.search).get("code");s?s=`?code=${encodeURIComponent(s)}`:s="",n.href=`https://operatorjen.github.io/${a}${s}`,n.textContent=e||"\u25B2\u25B2\u25B2",document.body.appendChild(n);let t=document.createElement("a");t.id="garden-lnk",t.href="https://operatorjen.github.io/systems.as.games/ECOSYSTEM/garden.html",t.textContent="\u{1F333}",document.body.appendChild(t);let i=document.createElement("a");i.id="river-lnk",i.href="https://operatorjen.github.io/systems.as.games/ECOSYSTEM/river.html",i.textContent="\u3030\uFE0F",document.body.appendChild(i);let c=document.createElement("a");c.id="mountain-lnk",c.href="https://operatorjen.github.io/systems.as.games/ECOSYSTEM/mountain.html",c.textContent="\u26F0\uFE0F",document.body.appendChild(c)}var h=(o,a="elements")=>{let e=f(o),n=encodeURIComponent(o);if(!e)return`/systems.as.games/garden.html?code=${n}`;let s=r=>Number(r||0),t={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:s(e?.motifs?.helios?.level),crags:s(e?.motifs?.crags?.level),garden:s(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((o||"").replace(/\D/g,"")||0))},i={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(i[o])return`/${i[o]}/index.html?code=${n}`;let c={elements:[{when:r=>t.day&&t.helios>=3,to:"mcsv"},{when:r=>t.wind||t.crags>=3,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.water||t.life,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],facet:[{when:r=>/sound|music|noise/.test(t.facet),to:"mcsv"},{when:r=>/mountain|rock|crag|cave/.test(t.facet),to:"1k.quantumworm"},{when:r=>/garden|river|organism|bio|life/.test(t.facet),to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],calmVsWild:[{when:r=>(t.wind?1:0)+(t.crags>=2?1:0)+(t.day?0:1)>=2,to:"1k.quantumworm"},{when:r=>t.garden>=2||t.life,to:"artificial.lifeforms"},{when:r=>t.day||t.helios>=2,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}],hash:[{when:r=>t.seed%4===0,to:"mcsv"},{when:r=>t.seed%4===1,to:"1k.quantumworm"},{when:r=>t.seed%4===2,to:"artificial.lifeforms"},{when:r=>!0,to:"art.of.noise"}],rarity:[{when:r=>t.helios>=4&&t.crags>=4,to:"1k.quantumworm"},{when:r=>t.garden>=4,to:"artificial.lifeforms"},{when:r=>t.helios>=4,to:"mcsv"},{when:r=>!0,to:"art.of.noise"}]},d=c[a]||c.elements;return`/${(d.find(r=>r.when(e))||d[d.length-1]).to}/index.html?code=${n}`};function x(o){let a=h(o),e=SAG?.get?.()||{},n=new Set(e.flags||[]);n.add(`unlock:${o}`).add(`active:${o}`);let s=SAG.href(a,{flags:[...n]});location.assign(s)}var f=o=>{let a=m(o);if(!a)return null;let{R:e,G:n,M:s,seed:t}=a,i=v(e,n,s);return{code:a.code,seed:t,motifs:{garden:{level:e,name:w[e]},helios:{level:n,name:p[n]},crags:{level:s,name:S[s]},facet:{level:i,name:G[i]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+n*.06,gateCost:1+s,wind:s>=3,facetDepth:i,daylight:!(n%2)}}},u=(o,{crumbsSelector:a="#crumbs-rail"}={})=>{if(!o)return;let{code:e,motifs:n,knobs:s}=o,t=SAG?.get?.()||{},i=new Set(t.flags||[]);for(let l of[...i])l.startsWith("active:SAG-")&&i.delete(l);i.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...i]}),SAGGame?.toast?.(`${e} \u2014 ${n.garden.name} \xB7 ${n.helios.name} \xB7 ${n.crags.name} \xB7 ${n.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let l=document.documentElement;l.dataset.sag=e,l.dataset.sagGarden=n.garden.level,l.dataset.sagHelios=n.helios.level,l.dataset.sagCrags=n.crags.level,l.dataset.sagFacet=n.facet.level,l.dataset.sagWind=s.wind?"1":"0",l.dataset.sagDay=s.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!s.wind),SAGGame?.setTheme?.(s.daylight?"day":"night"),SAGGame?.setFacetDepth?.(s.facetDepth);let c=SAG.get()||{},d=new Set(c.flags||[]);SAGGame?.breadcrumbs?.([[`active:${e}`,h(e),`${e}`],...A(d)],a)},$=(o,a)=>{let e=f(o);return e&&(u(e,a),e)},k=(o,a,e="overlay")=>{let n=m(o),s=m(a);if(!n||!s)return null;let t=e==="overlay"?Math.max:(i,c)=>(i^c)%7;return`SAG-${t(n.R,s.R)}${t(n.G,s.G)}${t(n.M,s.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:g,parseSAG:m,worldFromSAG:f,activateSAGWorld:u,activateCode:$,mergeSAG:k,addWorldSymbol:y});})();
