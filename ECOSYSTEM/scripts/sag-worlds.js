(()=>{var h=n=>/^sag[-\s]?[0-6]{3}$/i.test(n),c=n=>{let r=String(n||"").normalize("NFKC").trim().toUpperCase().replace(/[\s\u2010-\u2015\u2212\uFE58\uFE63\uFF0D]+/g,"-"),e=/^SAG-([0-6])([0-6])([0-6])$/.exec(r);return e?{code:`SAG-${e[1]}${e[2]}${e[3]}`,R:+e[1],G:+e[2],M:+e[3],seed:e[1]*49+e[2]*7+ +e[3]}:null},u=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],w=["dark","dim","glint","bright","halo","gaze","overwatch"],G=["plain","hills","ridge","cliffs","crags","glacier","abyss"],v=["none","hint","cells","triangles","pyramids","facets","tessellation"],A=(n,r,e)=>(n+2*r+3*e)%7,f=(n,r="elements")=>{let e=m(n),a=encodeURIComponent(n);if(!e)return`/mcsv/index.html?code=${a}`;let o=s=>Number(s||0),t={day:!!e?.knobs?.daylight,wind:!!e?.knobs?.wind,water:!!e?.knobs?.water,life:!!e?.knobs?.life,helios:o(e?.motifs?.helios?.level),crags:o(e?.motifs?.crags?.level),garden:o(e?.motifs?.garden?.level),facet:String(e?.motifs?.facet||"").toLowerCase(),seed:Number(e?.seed??((n||"").replace(/\D/g,"")||0))},l={"SAG-000":"art.of.noise","SAG-001":"1k.quantumworm","SAG-003":"bean.sims","SAG-006":"mcsv","SAG-011":"artificial.lifeforms"};if(l[n])return`/${l[n]}/index.html?code=${a}`;let i={elements:[{when:s=>t.day&&t.helios>=3,to:"mcsv"},{when:s=>t.wind||t.crags>=3,to:"1k.quantumworm"},{when:s=>t.garden>=2||t.water||t.life,to:"artificial.lifeforms"},{when:s=>!0,to:"art.of.noise"}],facet:[{when:s=>/sound|music|noise/.test(t.facet),to:"mcsv"},{when:s=>/mountain|rock|crag|cave/.test(t.facet),to:"1k.quantumworm"},{when:s=>/garden|river|organism|bio|life/.test(t.facet),to:"artificial.lifeforms"},{when:s=>!0,to:"art.of.noise"}],calmVsWild:[{when:s=>(t.wind?1:0)+(t.crags>=2?1:0)+(t.day?0:1)>=2,to:"1k.quantumworm"},{when:s=>t.garden>=2||t.life,to:"artificial.lifeforms"},{when:s=>t.day||t.helios>=2,to:"mcsv"},{when:s=>!0,to:"art.of.noise"}],hash:[{when:s=>t.seed%4===0,to:"mcsv"},{when:s=>t.seed%4===1,to:"1k.quantumworm"},{when:s=>t.seed%4===2,to:"artificial.lifeforms"},{when:s=>!0,to:"art.of.noise"}],rarity:[{when:s=>t.helios>=4&&t.crags>=4,to:"1k.quantumworm"},{when:s=>t.garden>=4,to:"artificial.lifeforms"},{when:s=>t.helios>=4,to:"mcsv"},{when:s=>!0,to:"art.of.noise"}]},d=i[r]||i.elements;return`/${(d.find(s=>s.when(e))||d[d.length-1]).to}/index.html?code=${a}`};function _(n){let r=f(n),e=SAG?.get?.()||{},a=new Set(e.flags||[]);a.add(`unlock:${n}`).add(`active:${n}`);let o=SAG.href(r,{flags:[...a]});location.assign(o)}var m=n=>{let r=c(n);if(!r)return null;let{R:e,G:a,M:o,seed:t}=r,l=A(e,a,o);return{code:r.code,seed:t,motifs:{garden:{level:e,name:u[e]},helios:{level:a,name:w[a]},crags:{level:o,name:G[o]},facet:{level:l,name:v[l]}},knobs:{spawnRate:.25+e*.08,revealChance:.08+a*.06,gateCost:1+o,wind:o>=3,facetDepth:l,daylight:!(a%2)}}},g=(n,{crumbsSelector:r="#crumbs-rail"}={})=>{if(!n)return;let{code:e,motifs:a,knobs:o}=n,t=SAG?.get?.()||{},l=new Set(t.flags||[]);l.add(`unlock:${e}`).add(`active:${e}`),SAG?.set?.({flags:[...l]}),SAGGame?.toast?.(`${e} \u2014 ${a.garden.name} \xB7 ${a.helios.name} \xB7 ${a.crags.name} \xB7 ${a.facet.name}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let i=document.documentElement;i.dataset.sag=e,i.dataset.sagGarden=a.garden.level,i.dataset.sagHelios=a.helios.level,i.dataset.sagCrags=a.crags.level,i.dataset.sagFacet=a.facet.level,i.dataset.sagWind=o.wind?"1":"0",i.dataset.sagDay=o.daylight?"1":"0"}catch{}SAGGame?.setWind?.(!!o.wind),SAGGame?.setTheme?.(o.daylight?"day":"night"),SAGGame?.setFacetDepth?.(o.facetDepth),SAGGame?.breadcrumbs?.([[`active:${e}`,f(e),`Enter ${e}`]],r)},S=(n,r)=>{let e=m(n);return e&&(g(e,r),e)},p=(n,r,e="overlay")=>{let a=c(n),o=c(r);if(!a||!o)return null;let t=e==="overlay"?Math.max:(l,i)=>(l^i)%7;return`SAG-${t(a.R,o.R)}${t(a.G,o.G)}${t(a.M,o.M)}`};typeof window<"u"&&(window.SAGWorlds={isSAG:h,parseSAG:c,worldFromSAG:m,activateSAGWorld:g,activateCode:S,mergeSAG:p});})();
