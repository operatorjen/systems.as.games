(()=>{var A={garden:{seedling:"\u{1F331}",leaf:"\u{1F343}",jar:"\u{1FAD9}",ant:"\u{1F41C}",eagle:"\u{1F985}",feather:"\u{1FAB6}",owl:"\u{1F989}"},river:{water:"\u{1F4A7}",gold:"\u{1F4B0}",wood:"\u{1FAB5}",stone:"\u{1FAA8}",reed:"\u{1F33F}",fish:"\u{1F41F}",sponge:"\u{1F9FD}"},mountain:{water:"\u{1F4A7}",mushroom:"\u{1F344}",wood:"\u{1FAB5}",stone:"\u{1FAA8}",ice:"\u{1F9CA}",gem:"\u{1F48E}",tool:"\u{1FA93}"}},k={garden:["seedling","leaf","jar","ant","eagle","feather","owl"],river:["water","gold","wood","stone","reed","fish","sponge"],mountain:["water","mushroom","wood","stone","ice","gem","tool"]},Xe=[{inputs:["SAG-001","leaf","gem"]},{inputs:["SAG-235","SAG-041","SAG-466"]},{inputs:["water","SAG-125","tool"]}],M={garden:Object.fromEntries(k.garden.map((c,a)=>[c,a])),river:Object.fromEntries(k.river.map((c,a)=>[c,a])),mountain:Object.fromEntries(k.mountain.map((c,a)=>[c,a]))};function ve(c,a,f,l="SAG-"){let m=M.garden[a],u=M.river[c],h=M.mountain[f];return[u,m,h].some(d=>d==null)?null:`${l}${u}${m}${h}`}var xe=c=>/^SAG-[0-6]{3}$/.test(String(c));function H(c){let a=/^SAG-(\d)(\d)(\d)$/.exec(String(c));return a?{r:+a[1],g:+a[2],m:+a[3]}:null}function De(c){let a=c.slice(0,3);if(a.every(xe)){let u=H(a[0]),h=H(a[1]),d=H(a[2]);return`SAG-${u.r}${h.g}${d.m}`}let f=null,l=null,m=null;for(let u of a){if(xe(u)){let h=H(u);f==null&&(f=h.r),l==null&&(l=h.g),m==null&&(m=h.m);continue}u in M.river&&(f=M.river[u]),u in M.garden&&(l=M.garden[u]),u in M.mountain&&(m=M.mountain[u])}return f==null||l==null||m==null?null:`SAG-${f}${l}${m}`}var J=[{garden:"seedling",river:"water",mountain:"mushroom"},{garden:"leaf",river:"wood",mountain:"gem"},{garden:"jar",river:"sponge",mountain:"tool"}];function be(c=J,a=[]){return[...c.map(l=>[l.river,l.garden,l.mountain]),...a.map(l=>l.inputs)].filter(Boolean).map(l=>{let m=De(l),u=`unlock:${m}`,h=Object.create(null);for(let d of l)h[d]=(h[d]||0)+1;return{id:`code-${l.join("-")}`,label:m,icon:"\u{1F50F}",description:l.map(d=>A.river[d]||A.garden[d]||A.mountain[d]||"\u{1F50F}").join(" + ")+` \u2192 ${m}`,requires:h,gives:{[m]:1},flag:u}})}var Ue=be(J,Xe);function oe({crafts:c=J,previewSelector:a="#status"}={}){let f=new Set;function l(){let m=window.SAG&&window.SAG.get&&window.SAG.get()||{},u=m.inv||{},h=new Set(m.flags||{}),d=!1;for(let t of c){let K=ve(t.river,t.garden,t.mountain),T=t.flag||`unlock:${K}`;if(h.has(T)||f.has(T))continue;if((u[t.river]|0)>0&&(u[t.garden]|0)>0&&(u[t.mountain]|0)>0){d=!1;break}}if(d){el.textContent="";return}}setInterval(l,800),l()}function ze(){let c=[];for(let a of k.river)for(let f of k.garden)for(let l of k.mountain)c.push({river:a,garden:f,mountain:l});return c}var re=c=>Object.keys(c),we=re(A.river),Se=re(A.garden),Ae=re(A.mountain);function Ge(){let c=[];for(let a=0;a<we.length;a++)for(let f=0;f<Se.length;f++)for(let l=0;l<Ae.length;l++){let m=we[a],u=Se[f],h=Ae[l],d=`SAG-${a}${f}${l}`;c.push({id:`craft-${d}`,label:d,requires:{[m]:1,[u]:1,[h]:1},gives:{[d]:1},flag:`unlock:${d}`})}return c}var Ce={...A.river,...A.garden,...A.mountain};typeof window<"u"&&(window.SAGCodes={ICONS:A,ALPHABET:k,genCode:ve,CRAFTS:J,buildRecipes:be,RECIPES:Ue,startAutoUnlocker:oe,allCombos:ze});(()=>{let c=A.mountain,a=Ge();SAGGame.init(),SAGGame.inventory.init({title:"Mountain Inventory",recipes:a,icons:c,craftIcons:Ce}),oe();let f=Object.keys(c),l=Object.fromEntries(f.map(e=>[e,SAGGame.morseForWord(e)])),m=SAGGame.morseItemClaimer(l,{once:!1}),u=SAGGame.morse({el:"#shake",out:"#out",status:"#status",clear:"#clear",unit:240,tolerance:.55,letterGapMul:2.2,wordGapMul:5.5,autoWordMs:500,symbolSpacing:"thin",onWord(e){let n=SAGGame.claimSAG(e);if(n==="hit"||n==="duplicate"){u.reset();return}n=m(e),(n==="hit"||n==="duplicate")&&u.reset()}}),h="images/mountain.jpg",d=document.getElementById("shake"),t=d.getContext("2d",{alpha:!1,desynchronized:!0}),K=Math,{sin:T,exp:se,random:g,ceil:ie,min:O,PI:ae,abs:ye,ceil:Ie}=K,P=ae*2,Me=(e,n,i)=>e<n?n:e>i?i:e,$e=e=>e<40?40:e,le=e=>e<1?1:e,o={dpr:Math.max(1,O(2,devicePixelRatio||1)),img:null,o:null,oc:null,w:null,wc:null,s:null,sc:null,t0:performance.now(),lt:null,clouds:null,cw:0,ch:0},v=0,C=0,I=0;function ce(){let e=innerWidth,n=innerHeight;d.width=~~(e*o.dpr),d.height=~~(n*o.dpr),d.style.width=e+"px",d.style.height=n+"px",t.setTransform(o.dpr,0,0,o.dpr,0,0)}addEventListener("resize",ce,{passive:!0}),ce();class _{constructor({min:n,max:i,holdMin:s=2,holdMax:$=6,ease:b=.08}){Object.assign(this,{min:n,max:i,holdMin:s,holdMax:$,ease:b}),this.v=this._r(n,i),this.target=this.v,this.nextAt=0}_r(n,i){return n+g()*(i-n)}step(n){return n>=this.nextAt&&(this.target=this._r(this.min,this.max),this.nextAt=n+this._r(this.holdMin,this.holdMax)),this.v+=(this.target-this.v)*this.ease}}let L={Ax:new _({min:1,max:96}),Lx:new _({min:180,max:420}),Sx:new _({min:-.25,max:.25,holdMin:7,holdMax:10}),st:new _({min:2,max:4,holdMin:5,holdMax:10}),sunX:new _({min:.16,max:.28,holdMin:8,holdMax:14,ease:.03}),sunY:new _({min:.12,max:.22,holdMin:8,holdMax:14,ease:.03})},D=new Image;D.crossOrigin="anonymous",D.src=h,D.onload=()=>{o.img=D,requestAnimationFrame(de)};let Re=(e,n,i)=>{let s=e.naturalWidth,$=e.naturalHeight,b=s/$,G=n/i,p,x,R=0,q=0;return b>G?(x=i,p=x*b,R=(n-p)/2):(p=n,x=p/b,q=(i-x)/2),{sx:0,sy:0,sw:s,sh:$,dx:R,dy:q,dw:p,dh:x}};function W(e,n,i){return o[e]||(o[e]=document.createElement("canvas"),o[e[0]+"c"]=o[e].getContext("2d",{alpha:!0})),n=n|0,i=i|0,n<1&&(n=1),i<1&&(i=1),(o[e].width!==n||o[e].height!==i)&&(o[e].width=n,o[e].height=i),o[e[0]+"c"]}function Ee(){if(o.s)return;let e=64,n=W("s",e,e);n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e,e);let i=n.createRadialGradient(e/2,e/2,0,e/2,e/2,e/2);i.addColorStop(0,"rgba(255,255,255,.6)"),i.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=i,n.fillRect(0,0,e,e)}function Te(e,n){Ee();let i=7+(e|0)%4;o.clouds=[];let s=0,$=n*.75;for(let b=0;b<i;b++){let G=.8+g()*3.2,p=120*G,x=4+(g()*5|0),R=p/x,q=s+g()*($-s),U=-e+g()*(2*e),Q=12+g()*28,V=4+g()*16,F=.6+g()*2.2,z=.12+g()*.35,Y=g()*P;o.clouds.push({x:U,y:q,vx:Q,s:G,seg:x,step:R,amp:V,wfreq:F,a:z,phase:Y})}o.cw=e,o.ch=n}function de(e){Oe((e-o.t0)/1e3),requestAnimationFrame(de)}function Oe(e){if(!o.img)return;let n=d.width/o.dpr,i=d.height/o.dpr,s=Re(o.img,n,i),$=o.lt?e-o.lt:1/60;o.lt=e;let b=W("o",s.dw,s.dh);b.setTransform(1,0,0,1,0,0),b.drawImage(o.img,s.sx,s.sy,s.sw,s.sh,0,0,s.dw,s.dh),t.setTransform(o.dpr,0,0,o.dpr,0,0),t.clearRect(0,0,n,i);{let r=t.createPattern(o.o,"repeat");t.save(),t.setTransform(1,0,0,1,0,0),t.fillStyle=r,t.fillRect(0,0,n,i),t.restore()}if(C){let r=(g()-.5)*.02*C,w=(g()-.5)*2*C,S=(g()-.5)*2*C;t.translate(w,S),r&&t.rotate(r)}let G=L.sunX.step(e)*n,p=L.sunY.step(e)*i,x=O(n,i)*.42,R=t.createRadialGradient(G,p,0,G,p,x),q=Me(.85+.7*I,.65,1);R.addColorStop(0,`rgba(255,112,80,${.85*q})`),R.addColorStop(1,"rgba(255,12,120,0)"),t.save(),t.translate(s.dx,s.dy);let U=L.Ax.step(e),Q=$e(L.Lx.step(e)),V=L.Sx.step(e),F=le(L.st.step(e)|0),z=s.dh*.12,Y=s.dh*.22,je=1/(2*Y*Y),ue=1+v*.1,me=U*ue+2,fe=(v>0?(2+2*v)*.01:0)+1,E=Ie(me>fe?me:fe),ge=s.dw+E*2,he=s.dh+E*2,Z=W("w",ge,he);Z.setTransform(1,0,0,1,0,0),Z.clearRect(0,0,ge,he);for(let r=-1;r<=1;r++)for(let w=-1;w<=1;w++)Z.drawImage(o.o,E+w*s.dw,E+r*s.dh);for(let r=0,w=ie(s.dh/F);r<w;r++){let S=r*F,y=O(F,s.dh-S),X=se(-(S-z)*(S-z)*je),j=S/Q*P+e*P*V,ee=T(j)*U*X*ue,N=E-ee,B=E+S;t.drawImage(o.w,N,B,s.dw,y,0,S,s.dw,y)}if(v>0){t.globalAlpha=g()*.85;let r=v,w=le(F*g()*81.2|0),S=.14,y=.61,X=g()*.75;for(let j=0,ee=ie(s.dw/w);j<ee;j++){let N=j*w,B=O(w,s.dw-N),te=e*P*X,ne=N,Pe=ye((ne*y+te)/ae%2-1)*2-1,_e=T(ne*S+te),Le=T(ne*y+te)*.5,qe=(_e+Le+Pe*.4)*(6+4*r),Fe=E+N,Ne=E-qe;t.drawImage(o.w,Fe,Ne,B,s.dh,N,0,B,s.dh)}t.globalAlpha=1}(!o.clouds||o.cw!==n||o.ch!==i)&&Te(n,i),t.save();let pe=s.dh;t.beginPath(),t.rect(-s.dx,-s.dy,n,pe),t.clip(),t.globalCompositeOperation="screen";for(let r of o.clouds){r.x+=r.vx*$,r.x>n+r.step*r.seg&&(r.x=-r.step*r.seg-g()*n*.4,r.y=g()*pe,r.vx=12+g()*38);let w=o.s.width*r.s*1.6,S=o.s.height*r.s*.8;t.globalAlpha=r.a;for(let y=0;y<r.seg;y++){let X=r.x+y*r.step,j=r.y+T(e*r.wfreq+y*.6+r.phase)*r.amp;t.drawImage(o.s,X,j,w,S)}}t.globalAlpha=1,t.restore(),t.restore();let ke=s.dy+s.dh*.75;if(t.save(),t.globalCompositeOperation="screen",t.beginPath(),t.rect(0,0,n,ke),t.clip(),t.fillStyle=R,t.beginPath(),t.arc(G,p,x,0,P),t.fill(),I>0){let r=t.createRadialGradient(G,p,0,G,p,x*.2);r.addColorStop(0,`rgba(255,160,40,${.75*I})`),r.addColorStop(1,"rgba(255,160,40,0)"),t.globalCompositeOperation="color-burn",t.fillStyle=r,t.beginPath(),t.arc(G,p,x*.2,0,P),t.fill()}t.restore(),v>0&&(v*=.9,v<.01&&(v=0)),I>0&&(I*=.18,I<.01&&(I=0)),C>0&&(C*=.16,C<.01&&(C=0))}d.addEventListener("click",()=>{v=O(3,v+6.5),C=O(2,C+3.65),I=O(1,I+1.9)})})();})();
