(()=>{var oe=f=>/^sag[-\s]?[0-6]{3}$/i.test(String(f));function V(f){let n=String(f||"").trim().toUpperCase().replace(/\s/,"-"),d=/^SAG-([0-6])([0-6])([0-6])$/.exec(n);if(!d)return null;let i=+d[1],u=+d[2],S=+d[3];return{code:`SAG-${i}${u}${S}`,R:i,G:u,M:S,seed:i*49+u*7+S}}var fe=["barren","sprout","leafy","bloom","grove","orchard","sanctuary"],ge=["dark","dim","glint","bright","halo","gaze","overwatch"],pe=["plain","hills","ridge","cliffs","crags","glacier","abyss"],me=["none","hint","cells","triangles","pyramids","facets","tessellation"];function be(f,n,d){return(f+2*n+3*d)%7}function Z(f){let n=V(f);if(!n)return null;let{R:d,G:i,M:u,seed:S}=n,b=be(d,i,u),h=.25+d*.08,a=.08+i*.06,g=1+u,x=u>=3,A=b,C=i%2===0;return{code:n.code,seed:S,motifs:{garden:{level:d,name:fe[d]},helios:{level:i,name:ge[i]},crags:{level:u,name:pe[u]},facet:{level:b,name:me[b]}},knobs:{spawnRate:h,revealChance:a,gateCost:g,wind:x,facetDepth:A,daylight:C}}}function ee(f,{crumbsSelector:n="#crumbs-rail"}={}){if(!f)return;let{code:d,motifs:i,knobs:u}=f,S=typeof SAG<"u"&&SAG.get?SAG.get()||{}:{},b=new Set(S.flags||[]);b.add(`unlock:${d}`),b.add(`active:${d}`),SAG?.set?.({flags:[...b]});let h=`${i.garden.name} \xB7 ${i.helios.name} \xB7 ${i.crags.name} \xB7 ${i.facet.name}`;SAGGame?.toast?.(`${d} \u2014 ${h}`,{title:"SAG Activated",icon:"\u{1F50F}",life:2e3});try{let a=document.documentElement;a.dataset.sag=d,a.dataset.sagGarden=String(i.garden.level),a.dataset.sagHelios=String(i.helios.level),a.dataset.sagCrags=String(i.crags.level),a.dataset.sagFacet=String(i.facet.level),a.dataset.sagWind=u.wind?"1":"0",a.dataset.sagDay=u.daylight?"1":"0"}catch{}if(SAGGame?.setWind?.(!!u.wind),SAGGame?.setTheme?.(u.daylight?"day":"night"),SAGGame?.setFacetDepth?.(u.facetDepth),SAGGame?.breadcrumbs){let a=encodeURIComponent(d);SAGGame.breadcrumbs([[`active:${d}`,`./worlds/${d}.html?code=${a}`,`Enter ${d}`],[`active:${d}`,`./trail.html?code=${a}`,"Follow the Trail"]],n)}}function se(f,n){let d=Z(f);return d&&ee(d,n),d}function ae(f,n,d="overlay"){let i=V(f),u=V(n);if(!i||!u)return null;let S,b,h;return d==="overlay"?(S=Math.max(i.R,u.R),b=Math.max(i.G,u.G),h=Math.max(i.M,u.M)):(S=(i.R^u.R)%7,b=(i.G^u.G)%7,h=(i.M^u.M)%7),`SAG-${S}${b}${h}`}typeof window<"u"&&(window.SAGWorlds={isSAG:oe,parseSAG:V,worldFromSAG:Z,activateSAGWorld:ee,activateCode:se,mergeSAG:ae});window.SAGWorlds={isSAG:oe,worldFromSAG:Z,activateSAGWorld:ee,activateCode:se,mergeSAG:ae};var Q=f=>/^SAG-[0-6]{3}$/.test(String(f));(function(f){let n=Object.freeze({A:".-",B:"-...",C:"-.-.",D:"-..",E:".",F:"..-.",G:"--.",H:"....",I:"..",J:".---",K:"-.-",L:".-..",M:"--",N:"-.",O:"---",P:".--.",Q:"--.-",R:".-.",S:"...",T:"-",U:"..-",V:"...-",W:".--",X:"-..-",Y:"-.--",Z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----."});function d(e){if(!e)return"";let t=String(e).toUpperCase();return n[t]||""}function i(e){return String(e||"").split("").map(d).filter(Boolean).join(" ")}function u(e,t){let o=String(e||"").trim().replace(/\s+/g," ");return Object.keys(t).find(s=>t[s]===o)}function S(){let e=document.createElement("div");e.id="interface";let t=document.createElement("div");t.id="out",e.appendChild(t);let o=document.createElement("button");o.id="clear",o.textContent="Clear",e.appendChild(o);let s=document.createElement("div");s.id="status",e.appendChild(s),document.body.appendChild(e);let y=document.createElement("div");y.id="notification",e.appendChild(y);let w=document.createElement("div");w.id="crumbs-rail",w.className="sag-crumbs",e.appendChild(w)}function b(e){let t=f.get()||{},o=new Set(t.flags||[]);return(e||[]).every(s=>o.has(s))}function h(e,t){b(e)||document.querySelectorAll(t).forEach(o=>o.remove())}function a(e,t){let o=0;for(let[s,y]of Object.entries(t||{}))(e[s]|0)>=y&&o++;return o}function g(e,t){document.querySelectorAll(t).forEach(o=>{o.style.display=b(e)?"":"none"})}function x(e,t){document.querySelectorAll(t).forEach(o=>{o.style.display=b(e)?"none":""})}function A(e){f.set({flags:[e]})}function C(e,t,o){document.querySelectorAll(e).forEach(s=>{b(t)?(s.href=f.href(s.getAttribute("href"),o||{}),s.classList.add("sag-enabled")):s.classList.remove("sag-enabled")})}function j(e,t){let o=new Set(f.get()?.flags||[]),s=(e||[]).filter(([w])=>o.has(w)).map(([w,R,l])=>`<a class="sag-link" data-flags="${w}" href="${R}">${l}</a>`).join(" \u2022 "),y=document.querySelector(t);y&&(y.innerHTML=s||"",f.enhance&&f.enhance(y))}function L(e,t,o,s,y){let w=document.querySelector(e);if(!w)return;w.style.touchAction="none",w.style.webkitUserSelect="none",w.style.webkitTouchCallout="none";let R=(f.get()?.flags||[]).includes(o),l=s?document.querySelector(s):null;R&&l&&(l.style.display="");let $=0;w.addEventListener("click",()=>{if($++,navigator.vibrate)try{navigator.vibrate(10)}catch{}},{passive:!0}),w.addEventListener("click",()=>{$>=(t||1)&&(f.set({flags:[o],...y||{}}),l&&(l.style.display=""),$=-1)},{passive:!0})}function N(e){e=e||document,e.querySelectorAll("[data-ratchet]").forEach(t=>{let o=t.getAttribute("data-ratchet");o&&A(o)}),e.querySelectorAll("[data-requires]").forEach(t=>{let o=(t.getAttribute("data-requires")||"").split(",").map(s=>s.trim()).filter(Boolean);b(o)||t.remove()}),e.querySelectorAll("a[data-requires]").forEach(t=>{let o=(t.getAttribute("data-requires")||"").split(",").map(R=>R.trim()).filter(Boolean),s=(t.getAttribute("data-flags")||"").split(",").map(R=>R.trim()).filter(Boolean),y=t.getAttribute("data-step"),w=Object.assign({},s.length?{flags:s}:null,y?{step:y}:null);b(o)&&(t.href=f.href(t.getAttribute("href"),w))}),e.querySelectorAll("[data-collect-after][data-collect-flag]").forEach(t=>{let o=parseInt(t.getAttribute("data-collect-after")||"1",10),s=t.getAttribute("data-collect-flag"),y=t.getAttribute("data-reveal");L("#"+t.id,o,s,y)})}function r(e){e=e||{};let t=e.el?document.querySelector(e.el):document.querySelector("canvas");if(!t||(t.addEventListener("pointerdown",p=>{p.preventDefault(),de()},{passive:!1}),t.addEventListener("pointerup",p=>{p.preventDefault(),ue()},{passive:!1}),t.addEventListener("pointercancel",()=>{m&&(ce(),m=0)},{passive:!0}),t.style.touchAction="none",t.style.webkitTouchCallout="none",!t))return;let o=e.out?document.querySelector(e.out):null,s=e.status?document.querySelector(e.status):null,y=e.clear?document.querySelector(e.clear):null,w=e.unit||220,R=e.tolerance??.45,l=e.letterGapMul??2.5,$=e.wordGapMul??6,v=e.autoWordMs??1200,k=e.symbolSpacing||"thin",G=k==="thin"?"\u2009":k==="space"?" ":"",m=0,E=0,H=null,O=[],I=[],W=[],z=w,q=null,X=null,P="\u25C9",c="\u2583",T=p=>p.replace(/\./g,P).replace(/-/g,c);t.style.touchAction="none",t.style.webkitUserSelect="none",t.style.webkitTouchCallout="none";let B=p=>p.map(T).join(G);function M(){if(!s)return;let p=O.length?`${B([O.join("")])}`:"";s.textContent=p}function U(p){let D=z*(1+R),J=p<=D;return J&&(z=z*.7+p*.3),J?".":"-"}let K=p=>p>w*l,te=p=>p>w*$;function F(){if(!o)return;let p=[];for(let D of W)p.push(`<span class="word">${B([D])}</span>`);I.length&&p.push(`<span class="letters">${I.map(D=>B([D])).join(G+G)}</span>`),O.length&&p.push(`<span class="buffer">${B([O.join("")])}</span>`),o.innerHTML=p.join(G+G)}function _(){if(!O.length)return;let p=O.join("");I.push(p),O=[],F(),M(),e.onLetter&&e.onLetter(p,I.slice())}function ie(){if(_(),!I.length)return;let p=I.join(" ");W.push(p),I=[],F(),M(),e.onWord&&e.onWord(p,W.slice())}function re(){clearTimeout(H),H=setTimeout(ie,v)}let Y="";function le(){o&&(q||(q=document.createElement("span"),q.className="live-symbol",q.style.opacity="0.6",q.textContent=P,o.insertAdjacentElement("beforeend",q)),Y=P,s&&(s.textContent=T(O.join(""))+Y),clearTimeout(X),X=setTimeout(()=>{q&&(q.textContent=c,Y=c,s&&(s.textContent=T(O.join(""))+Y))},w*(1+R)))}function ce(){clearTimeout(X),X=null,q&&q.parentNode&&q.parentNode.removeChild(q),q=null,Y=""}function de(){if(m=performance.now(),t.classList.add("active"),navigator.vibrate)try{navigator.vibrate(5)}catch{}le(),clearTimeout(H),M(),e.onDown&&e.onDown()}function ue(){let p=performance.now(),D=p-m,J=m-E;E&&te(J)?ie():E&&K(J)&&_();let ne=U(D);if(O.push(ne),E=p,navigator.vibrate)try{navigator.vibrate(ne==="."?8:15)}catch{}ce(),F(),M(),re(),e.onSymbol&&e.onSymbol(ne,O.slice())}return document.addEventListener("keydown",p=>{if(!(p.metaKey||p.ctrlKey||p.altKey)&&/^[a-z0-9]$/i.test(p.key)){p.preventDefault();let D=d(p.key);D&&(O.length&&_(),I.push(D),F(),M(),re(),e.onLetter&&e.onLetter(D,I.slice()));return}},{passive:!1}),y&&y.addEventListener("click",()=>{O=[],I=[],W=[],o&&(o.innerHTML=""),F(),M()}),M(),{reset(){O=[],I=[],W=[],o&&(o.innerHTML=""),F(),M()},getWords:()=>W.slice(),getLetters:()=>I.slice(),setUnit:p=>w=p}}window.SAGGame={findItem:u,init:S,gate:h,showIf:g,hideIf:x,ratchet:A,condLink:C,breadcrumbs:j,collectAfterClicks:L,autowire:N,morse:r},window.SAGGame=Object.assign(window.SAGGame||{},{MORSE:n,morseForChar:d,morseForWord:i})})(SAG);(function(f){let n=r=>String(r||"").toLowerCase().replace(/\s+/g,"-"),d=new Map,i=Object.create(null),u=(r,e)=>(r=n(r),e=n(e),r<e?r+"|"+e:e+"|"+r);function S(r,e){let t=document.getElementById("notification");t.textContent=`You collected ${r} x ${e}`,t.className="active",setTimeout(()=>{t.textContent="",t.className=""},3e3)}function b(){return Object.assign({},f.get()?.inv||{})}function h(r){let e={};for(let t in r)r[t]>0&&(e[t]=r[t]|0);return f.set({inv:e}),e}function a(r,e=1){if(r=n(r),S(r,e),e|=0,e<=0)return b();let t=b();return t[r]=(t[r]|0)+e,h(t)}function g(r,e=1){if(r=n(r),e|=0,e<=0)return b();let t=b();return t[r]=Math.max(0,(t[r]|0)-e),h(t)}function x(r,e=1){return(b()[n(r)]|0)>=(e|0)}function A(r){for(let e of r||[]){if(!e)continue;let t=n(e.a),o=n(e.b),s=n(e.out);d.set(u(t,o),{a:t,b:o,out:s}),s in i||(i[s]=s.replace(/-/g," ")),t in i||(i[t]=t.replace(/-/g," ")),o in i||(i[o]=o.replace(/-/g," "))}}function C(r){Object.assign(i,r||{})}function j(r,e){let t=d.get(u(r,e));return t?x(t.a,1)&&x(t.b,1)?{ok:!0,out:t.out}:{ok:!1,reason:"insufficient"}:{ok:!1,reason:"no-recipe"}}function L(r,e){let t=j(r,e);if(!t.ok)return t;let o=d.get(u(r,e)),s=b();return s[o.a]=(s[o.a]|0)-1,s[o.a]<=0&&delete s[o.a],s[o.b]=(s[o.b]|0)-1,s[o.b]<=0&&delete s[o.b],s[o.out]=(s[o.out]|0)+1,f.set({inv:s,flags:[`crafted:${o.out}`]}),{ok:!0,out:o.out,label:i[o.out]||o.out,inv:s}}function N(){let r=[];for(let[e,t]of d)r.push({a:t.a,b:t.b,out:t.out,aLabel:i[t.a]||t.a,bLabel:i[t.b]||t.b,outLabel:i[t.out]||t.out});return r}document.addEventListener("click",r=>{let e=r.target.closest("[data-craft]");if(!e)return;let o=(e.getAttribute("data-craft")||"").trim().split("+").map(s=>s.trim()).filter(Boolean);if(o.length===2){let s=L(o[0],o[1]),y=document.getElementById("status");s.ok?(e.setAttribute("data-crafted",s.out),y&&(y.textContent=`Crafted ${i[s.out]||s.out}`)):y&&(y.textContent=s.reason==="insufficient"?"Not enough materials":"No recipe")}},{passive:!0}),window.SAGCraft={getInv:b,setInv:h,add:a,remove:g,have:x,can:j,craft:L,recipes:N,registerRecipes:A,setLabels:C}})(SAG);(function(f){"use strict";function n(a,g={},x=[]){let A=document.createElement(a);for(let[C,j]of Object.entries(g||{}))if(C==="class")A.className=j;else if(C==="style")A.style.cssText=j;else if(C.startsWith("on")&&typeof j=="function")A.addEventListener(C.slice(2),j);else{if(j==null||j===!1)continue;A.setAttribute(C,j===!0?"":j)}for(let C of x||[])C!=null&&(typeof C=="string"?A.appendChild(document.createTextNode(C)):A.appendChild(C));return A}function d(a){return typeof a=="string"?document.querySelector(a):a}function i(){if(document.getElementById("sag-toast-style"))return;document.head.appendChild(n("style",{id:"sag-toast-style"},[`
    #sag-toast-container{font-family:monospace;position:fixed;top:16px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
    .sag-toast{min-width:200px;max-width:360px;background:rgba(20,20,25,.95);color:#fff;padding:10px 14px;border-radius:3px;box-shadow:0 8px 24px rgba(0,0,0,.25);display:grid;grid-template-columns:auto 1fr;gap:8px;align-items:center;transform:translateX(120%);opacity:0;animation:sag-slide-in .22s ease-out forwards,sag-fade-out .32s ease-in forwards var(--life,2200ms)}
    .sag-toast .icon{font-size:18px;line-height:1;opacity:.9}
    .sag-toast .title{font-weight:700}
    .sag-toast .meta{opacity:.8;font-size:.9em}
    @keyframes sag-slide-in{to{transform:translateX(0);opacity:1}}
    @keyframes sag-fade-out{to{transform:translateX(120%);opacity:0}}`]))}function u(){let a=document.getElementById("sag-toast-container");return a||(a=n("div",{id:"sag-toast-container"}),document.body.appendChild(a)),a}function S(a,g={}){i();let{title:x="Collected",icon:A="\u2B50",life:C=2200}=g,j=u(),L=n("div",{class:"sag-toast"});return L.style.setProperty("--life",`${C}ms`),L.appendChild(n("div",{class:"icon","aria-hidden":"true"},[A])),L.appendChild(n("div",{},[n("div",{class:"title"},[x]),n("div",{class:"meta"},[a])])),j.appendChild(L),setTimeout(()=>L.remove(),C+600),L}function b(a,{label:g=a,count:x=1,icon:A="\u2B50",life:C=2200}={}){let j=f.get()||{},L=Object.assign({},j.inv||{}),N=(L[a]||0)+x;L[a]=N;let r=f.set({inv:L,flags:[`collected:${a}`]});return S(`${g} \xD7 ${N}`,{title:"Collected",icon:A,life:C}),r}let h=function(){let a=[],g={title:"Inventory",openButton:null,icons:{},craftIcons:{}},x;function A(){let $=((f.get()||{}).flags||[]).find(v=>v.startsWith("active:SAG-"));return $?$.replace("active:",""):null}function C(){let l=A();if(!l)return n("div",{class:"sag-section"},[n("h3",{},["World"]),n("div",{},["No SAG active. Craft one to reshape the rules."])]);let $=window.SAGWorlds?.worldFromSAG?window.SAGWorlds.worldFromSAG(l):null;if(!$)return n("div",{class:"sag-section"},[n("h3",{},["World"]),n("div",{},[l])]);let{motifs:v,knobs:k}=$,G=(m,E)=>n("div",{class:"kv"},[n("b",{},[m,": "]),String(E)]);return n("div",{class:"sag-section sag-world"},[n("h3",{},["World"]),n("div",{class:"pill"},["\u{1F50F} ",l]),n("div",{class:"grid"},[G("Garden",`${v.garden.name} (${v.garden.level})`),G("Helios",`${v.helios.name} (${v.helios.level})`),G("Crags",`${v.crags.name} (${v.crags.level})`),G("Facet",`${v.facet.name} (${v.facet.level})`)]),n("div",{class:"grid"},[G("Spawn",k.spawnRate.toFixed(2)),G("Reveal",(100*k.revealChance|0)+"%"),G("Gate",k.gateCost),G("Wind",k.wind?"on":"off")])])}SAGGame.renderWorldBanner=C;function j(){if(document.getElementById("sag-inv-style"))return;document.head.appendChild(n("style",{id:"sag-inv-style"},[`
      .sag-overlay{font-family:monospace;position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:saturate(90%) blur(1px);opacity:0;pointer-events:none;transition:opacity .18s ease;overflow:auto;}
      .sag-drawer{position:fixed;top:0;right:0;height:85%;width:min(420px,90vw);background:#0f1115;color:#e8eaf0;box-shadow:-12px 0 32px rgba(0,0,0,.35);transform:translateX(100%);transition:transform .22s ease;display:flex;flex-direction:column;z-index:9998}
      .sag-drawer header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
      .sag-drawer header h2{margin:0;margin-top: 10px;}
      .sag-drawer .body{padding:12px 16px;overflow:auto;flex:1;display:grid;gap:16px}
      .sag-section h3{margin:0 0 8px 0;margin-top: 10px;}
      .sag-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
      .sag-item{background:#151821;border:1px solid rgba(255,255,255,.06);border-radius:3px;padding:10px;display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}
      .sag-item .ic{font-size:18px} .sag-item .name{font-weight:600}
      .sag-item .qty{opacity:.85;font-variant-numeric:tabular-nums}
      .sag-recipe{background:#13161d;border:1px solid rgba(255,255,255,.08);border-radius:3px;padding:12px;display:grid;gap:10px}
      .sag-recipe .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
      .sag-chip{background:#1d2230;border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px;font-size:12px;display:inline-grid;grid-auto-flow:column;gap:6px;align-items:center}
      .sag-btn{appearance:none;border:0;border-radius:3px;background:#3b82f6;color:#fff;padding:8px 10px;font-weight:600;cursor:pointer;transition:filter .12s ease}
      .sag-btn[disabled]{opacity:.5;cursor:not-allowed} .sag-btn:hover{filter:brightness(1.05)}
      .sag-footer{padding:12px 16px;border-top:1px solid rgba(255,255,255,.06);display:flex;justify-content:flex-end;gap:8px}
      .sag-openbtn{position:fixed;right:16px;bottom:16px;padding:10px 12px;border-radius:3px;background:#151821;border:1px solid rgba(255,255,255,.08);color:#e8eaf0;font-weight:600;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.25);z-index:9999}
      .sag-openbtn:hover{filter:brightness(1.05)}
      .sag-visible .sag-overlay{opacity:1;pointer-events:auto}
      .sag-visible .sag-drawer{transform:translateX(0)}`]))}function L(l,$){for(let[v,k]of Object.entries($||{}))if((l[v]||0)<k)return!1;return!0}function N(l){let k={...{...(f.get()||{}).inv||{}}};for(let[W,z]of Object.entries(l.requires||{}))k[W]=Math.max(0,(k[W]||0)-z);let G=Object.keys(l.gives||{}).length?l.gives:{[l.label||l.id]:1};for(let[W,z]of Object.entries(G))k[W]=(k[W]||0)+z;let m={inv:k};l.flag&&(m.flags=[l.flag]),f.set(m);let E=Object.keys(G).find(W=>/^SAG-/.test(W)),H=E?"SAG Crafted":"Crafted",O=E?"\u{1F50F}":"\u{1F9F0}",I=E||l.label||l.id;return SAGGame.toast(I,{title:H,icon:O,life:1800}),E&&window.SAGWorlds?.activateCode&&window.SAGWorlds.activateCode(E,{crumbsSelector:"#crumbs-rail"}),{gives:G,flag:l.flag||null}}function r(l){return l.replace(/[-_]/g," ")}function e(l){let $=new Set(Object.keys(g.craftIcons||{})),v=m=>/^SAG-[0-6]{3}$/.test(m),k=Object.keys(l).filter(m=>(l[m]|0)>0).filter(m=>$.has(m)||v(m)).sort((m,E)=>v(m)!==v(E)?v(m)?-1:1:m.localeCompare(E));if(!k.length)return n("div",{class:"sag-section"},[n("h3",{},["Inventory"]),n("div",{},["You have no items yet. Continue exploring."])]);let G=k.map(m=>{let E=/^SAG-/.test(m)?"\u{1F50F}":(g.craftIcons||{})[m]||"\u25FB\uFE0E",H=/^SAG-/.test(m)?m:r(m);return n("div",{class:"sag-item"},[n("div",{class:"ic"},[E]),n("div",{class:"name"},[H]),n("div",{class:"qty"},["\xD7 ",String(l[m])])])});return n("div",{class:"sag-section"},[n("h3",{},["Inventory"]),n("div",{class:"sag-grid"},G)])}function t(l){let $=f.get()||{},v=new Set($.flags||[]),k=a||[],G=SAGGame.inventory&&SAGGame.inventory.craftIcons||g.craftIcons||g.icons||{},m=c=>G[c]?G[c]:Q(c)?"\u{1F50F}":"\u25FB\uFE0E",E=c=>G[c]?r(c):String(c),H=k.filter(c=>!(c.flag&&v.has(c.flag))),O=(c,T="")=>{let B=L(l,c.requires),M=Object.entries(c.requires||{}).map(([F,_])=>n("span",{class:"sag-chip"},[m(F),` ${E(F)} \xD7 ${_}`])),U=Object.keys(c.gives||{}).length?c.gives:{[c.label||c.id]:1},K=Object.entries(U).map(([F,_])=>n("span",{class:"sag-chip"},[m(F),` ${E(F)} \xD7 ${_}`])),te=n("button",{class:"sag-btn",disabled:!B,onclick:()=>{N(c),o()}},[B?"Craft":"Need items"]);return n("div",{class:`sag-card ${T}`.trim()},[n("h2",{},[c.label||c.id]),n("div",{},[n("h3",{class:"lab"},["Requires: "]),...M]),n("div",{},[n("h3",{class:"lab"},["Gives: "]),...K]),te])},I=H.map(c=>O(c)),W=new Set([...[...v].filter(c=>c.startsWith("unlock:SAG-")).map(c=>c.replace("unlock:","")),...Object.keys(l).filter(Q)]),z=(c,T)=>{let B=0;for(let[M,U]of Object.entries(T||{}))(c[M]|0)>=U&&B++;return B},q=new Set(H.map(c=>c.id)),P=k.filter(c=>!q.has(c.id)).filter(c=>!(c.flag&&v.has(c.flag))).filter(c=>Object.keys(c.requires||{}).some(T=>Q(T)&&W.has(T))).sort((c,T)=>{let B=z(l,c.requires),M=z(l,T.requires);if(M!==B)return M-B;let U=Object.keys(c.requires||{}).some(Q),K=Object.keys(T.requires||{}).some(Q);return U===K?0:U?-1:1}).slice(0,6).map(c=>O(c,"sag-suggest"));return n("div",{class:"sag-section"},[n("h3",{},["Crafting"]),...I,...P.length?[n("h3",{},["Next combinations"]),...P]:[]])}function o(){if(!x)return;let l=f.get()||{},$=Object.assign({},l.inv||{}),v=x.querySelector(".body");v.innerHTML="",v.appendChild(SAGGame.renderWorldBanner()),v.appendChild(e($)),v.appendChild(t($));let k=(l.flags||[]).find(m=>m.startsWith("active:SAG-")),G=[["root","./index.html"]];if(k){let m=k.replace("active:",""),E=encodeURIComponent(m);G.push([`active:${m}`,`./worlds.html?code=${E}`,`Enter ${m}`])}SAGGame.breadcrumbs(G,"#crumbs-rail")}function s(){document.documentElement.classList.add("sag-visible"),o()}function y(){document.documentElement.classList.remove("sag-visible")}function w(){(document.documentElement.classList.contains("sag-visible")?y:s)()}function R(l){g=Object.assign({title:"Inventory",openButton:null,icons:{},craftIcons:null},l||{}),SAGGame.inventory.icons=g.icons,SAGGame.inventory.craftIcons=g.craftIcons||g.icons,a=l.recipes||[],o(),j();let $=n("div",{class:"sag-overlay",onclick:y});x=n("div",{class:"sag-drawer"},[n("header",{},[n("h2",{},[g.title]),n("button",{class:"sag-btn",onclick:y},["Close"])]),n("div",{class:"body"}),n("div",{class:"sag-footer"},[n("button",{class:"sag-btn",onclick:()=>{f.clear(),S("Inventory cleared",{title:"Reset",icon:"\u{1F5D1}\uFE0F"}),o()}},["Reset"])])]),document.body.appendChild($),document.body.appendChild(x);let v;return g.openButton?v=d(g.openButton):(v=n("button",{class:"sag-openbtn",title:"Inventory",onclick:w},["Inventory"]),document.body.appendChild(v)),v.addEventListener("click",w),{open:s,close:y,toggle:w,render:o}}return{init:R,open:s,close:y,toggle:w,render:o}}();window.SAGGame=Object.assign(window.SAGGame||{},{inventory:h,toast:S,collect:b})})(SAG);(function(){function f(n,{once:d=!1,flagPrefix:i="collected"}={}){let u=h=>String(h||"").trim().toLowerCase(),S=new Map;for(let[h,a]of Object.entries(n||{})){let g=(x,A)=>S.set(u(x),String(A));Array.isArray(a)?(a.forEach(x=>g(x,h)),g(h,h)):a===!0?g(h,h):typeof a=="string"?SAGGame.inventory?.craftIcons&&a in SAGGame.inventory.craftIcons||/^SAG-\d{3}$/.test(a)?g(h,a):(g(a,h),g(h,h)):g(h,a)}function b(h){return String(h).replace(/[-_]/g," ").replace(/\b\w/g,a=>a.toUpperCase())}return function(a){let g=S.get(u(a));if(!g)return"miss";let x=SAG.get()||{},A={...x.inv||{}},C=new Set(x.flags||[]),j=`${i}:${g}`;if(d&&C.has(j))return SAGGame.toast(`${b(g)} already claimed`,{title:"Hint",icon:"\u2139\uFE0F",life:1800}),"duplicate";A[g]=(A[g]||0)+1;let L={inv:A};d&&(L.flags=[j]),SAG.set(L);let N=SAGGame.inventory?.craftIcons?.[g]||(g.startsWith("SAG-")?"\u{1F50F}":"\u{1F392}");return SAGGame.toast(`+1 ${b(g)}`,{title:d?"Unlocked":"Collected",icon:N,life:1600}),"hit"}}window.SAGGame=Object.assign(window.SAGGame||{},{morseItemClaimer:f})})();(function(){let f=i=>String(i||"").trim().toLowerCase();function n(i){let u=f(i),S=/^(sag)[-\s]?([0-6]{3})$/.exec(u);return S?`SAG-${S[2]}`:null}function d(i){let u=n(i);if(!u)return"miss";let S=SAG.get()||{},b={...S.inv||{}},h=new Set(S.flags||[]),a=`unlock:${u}`;return h.has(a)?(SAGGame.toast(`${u} already unlocked`,{title:"Hint",icon:"\u2139\uFE0F",life:1600}),"duplicate"):(b[u]=(b[u]||0)+1,SAG.set({inv:b,flags:[a]}),SAGGame.toast(u,{title:"SAG Crafted",icon:"\u{1F50F}",life:1800}),window.SAGWorlds?.activateCode?.(u,{crumbsSelector:"#crumbs-rail"}),"hit")}SAGGame.claimSAG=d})();})();
