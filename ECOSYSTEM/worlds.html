<!doctype html>
<meta charset="utf-8">
<title>SAG World</title>
<div id="app"></div>
<script defer src="scripts/sag-worlds.pack.js"></script>
<script defer>
  (function () {
    const el = document.getElementById('app');
    function ready(fn){ (window.SAGWorlds) ? fn() : setTimeout(()=>ready(fn), 0); }

    ready(() => {
      const { parseSAG, worldFromSAG } = window.SAGWorlds;
      const raw = new URLSearchParams(location.search).get('code') || 'SAG-000';
      const parsed = parseSAG(raw);
      if (!parsed) { el.textContent = 'Unknown code.'; return; }
      
      const w = worldFromSAG(parsed.code);
      console.log(w)
      if (!w) { el.textContent = 'Unknown code.'; return; }

      const { code, motifs, knobs } = w;

      el.innerHTML = `
        <h1>${code}</h1>
        <p>${motifs.garden.name} · ${motifs.helios.name} · ${motifs.crags.name} · ${motifs.facet.name}</p>
        <ul>
          <li>Spawn: ${knobs.spawnRate.toFixed(2)}</li>
          <li>Reveal: ${Math.round(100 * knobs.revealChance)}%</li>
          <li>Gate: ${knobs.gateCost}</li>
          <li>Wind: ${knobs.wind ? 'on' : 'off'}</li>
        </ul>`;
    });
  })();
</script>
